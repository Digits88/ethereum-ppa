From c71308aa8798963d66ee2ae8d3c3a1f772678130 Mon Sep 17 00:00:00 2001
From: Stephan Binner <stephan.binner@basyskom.com>
Date: Mon, 1 Dec 2014 15:01:15 +0100
Subject: do proper escaping before replacing

Change-Id: I9d11038779494a3bb14107369b54c06baead96a9
Reviewed-by: Jocelyn Turcotte <jocelyn.turcotte@digia.com>
---
 tools/qmake/mkspecs/features/functions.prf | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/tools/qmake/mkspecs/features/functions.prf b/tools/qmake/mkspecs/features/functions.prf
index acf15a8..3a25bb0 100644
--- a/tools/qmake/mkspecs/features/functions.prf
+++ b/tools/qmake/mkspecs/features/functions.prf
@@ -70,7 +70,7 @@ defineReplace(findMocables) {
   for (file, input): \
       infiles += $$absolute_path($$file, $$_PRO_FILE_PWD_)
   mocables = $$system("python $$QTWEBENGINE_ROOT/tools/buildscripts/find-mocables $$infiles")
-  mocables = $$replace(mocables, $$_PRO_FILE_PWD_/, '')
+  mocables = $$replace(mocables, $$re_escape($${_PRO_FILE_PWD_}/), '')
   return($$mocables)
 }
 
@@ -84,8 +84,10 @@ defineReplace(findIncludedMocFiles) {
 defineReplace(mocOutput) {
   out = $$1
   # The order is important, since the output of the second replace would end up accidentaly transformed by the first one
-  out = $$replace(out, ^(.*)($$join(QMAKE_EXT_CPP,|)), $${QMAKE_CPP_MOD_MOC}\\1$${QMAKE_EXT_CPP_MOC})
-  out = $$replace(out, ^(.*)($$join(QMAKE_EXT_H,|)), $${QMAKE_H_MOD_MOC}\\1$${first(QMAKE_EXT_CPP)})
+  for(ext, $$list($${QMAKE_EXT_CPP})): \
+      out = $$replace(out, ^(.*)($$re_escape($${ext})), $${QMAKE_CPP_MOD_MOC}\\1$${QMAKE_EXT_CPP_MOC})
+  for(ext, $$list($${QMAKE_EXT_H})): \
+      out = $$replace(out, ^(.*)($$re_escape($${ext})), $${QMAKE_H_MOD_MOC}\\1$${first(QMAKE_EXT_CPP)})
   return($$out)
 }
 
-- 
cgit v0.11.0

